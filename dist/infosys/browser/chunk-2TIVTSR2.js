import{o as l}from"./chunk-ISHATJ3X.js";import{k as c,n as u,t as a}from"./chunk-O52SWWMB.js";var d=class i{constructor(e){this.apiService=e}transactions=a([]);isLoading=a(!1);error=a(null);loadTransactions(e){this.isLoading.set(!0),this.error.set(null),console.log("\u{1F504} Loading transactions from API...",e),this.apiService.getTransactions(e).subscribe({next:t=>{console.log("\u2705 Transactions loaded successfully:",t.length,"transactions"),this.transactions.set(t),this.isLoading.set(!1)},error:t=>{console.error("\u274C Error loading transactions:",t),console.error("Error details:",{status:t.status,statusText:t.statusText,message:t.message,error:t.error}),this.error.set(t.error?.message||"Failed to load transactions"),this.isLoading.set(!1),this.transactions.set([])}})}getTransactions(){return this.transactions()}getTransactionById(e){return this.transactions().find(t=>t.id===e)}getTransactionsByProduct(e){return this.transactions().filter(t=>t.productId===e)}getTransactionsByDateRange(e,t){return this.transactions().filter(r=>{let s=new Date(r.date),n=new Date(e),o=new Date(t);return o.setHours(23,59,59,999),s>=n&&s<=o})}createTransaction(e){return new Promise((t,r)=>{this.apiService.createTransaction({productId:e.productId,type:e.type,quantity:e.quantity,unitPrice:e.unitPrice,notes:e.notes}).subscribe({next:s=>{this.loadTransactions(),t(s)},error:s=>{console.error("Error creating transaction:",s),r(s)}})})}deleteTransaction(e){return new Promise((t,r)=>{this.apiService.deleteTransaction(e).subscribe({next:()=>{this.loadTransactions(),t(!0)},error:s=>{console.error("Error deleting transaction:",s),r(s)}})})}getTotalSales(e,t){let r=this.transactions().filter(s=>s.type==="sale");return e&&t&&(r=this.getTransactionsByDateRange(e,t).filter(s=>s.type==="sale")),r.reduce((s,n)=>s+n.totalAmount,0)}getTotalPurchases(e,t){let r=this.transactions().filter(s=>s.type==="purchase");return e&&t&&(r=this.getTransactionsByDateRange(e,t).filter(s=>s.type==="purchase")),r.reduce((s,n)=>s+n.totalAmount,0)}refresh(){this.loadTransactions()}static \u0275fac=function(t){return new(t||i)(u(l))};static \u0275prov=c({token:i,factory:i.\u0275fac,providedIn:"root"})};export{d as a};
