import{a as V}from"./chunk-D2QMP2IV.js";import{a as R}from"./chunk-TO3RD2LQ.js";import{a as z,b as L,c as N,f as W,h as F,n as j,o as B}from"./chunk-5PEZTGU7.js";import{$ as d,Ba as I,D as m,E as O,Fa as D,L as x,M as h,O as k,P as w,Q as u,R as e,S as t,T as _,U as y,V as g,W as f,Y as A,_ as n,aa as E,da as b,ea as C,fa as S,na as M,p as P,q as v,t as p,ua as T,z as a}from"./chunk-O52SWWMB.js";var J=(s,o)=>o.id;function U(s,o){if(s&1&&(e(0,"div",10),n(1),t()),s&2){let r=f();a(),d(r.error())}}function G(s,o){if(s&1&&(e(0,"div",11),n(1),t()),s&2){let r=f();a(),d(r.success())}}function K(s,o){s&1&&(e(0,"div",25)(1,"div",35),n(2,"\u2705"),t(),e(3,"h3"),n(4,"All Good!"),t(),e(5,"p"),n(6,"No low-stock alerts at this time."),t()())}function q(s,o){if(s&1){let r=y();e(0,"tr")(1,"td")(2,"div",36),_(3,"span",37),e(4,"div")(5,"strong"),n(6),t(),e(7,"span"),n(8),t()()()(),e(9,"td"),n(10),t(),e(11,"td")(12,"span",38),n(13),t()(),e(14,"td"),n(15),t(),e(16,"td")(17,"span",39),n(18),t()(),e(19,"td")(20,"button",40),g("click",function(){let c=P(r).$implicit,l=f(2);return v(l.navigateToProduct(c.id))}),n(21,"Reorder"),t()()()}if(s&2){let r=o.$implicit;a(6),d(r.name),a(2),d(r.category),a(2),d(r.sku),a(3),d(r.stockLevel),a(2),d(r.minStockThreshold),a(2),A("critical",r.stockLevel===0),a(),E(" ",r.stockLevel===0?"Critical":"Low"," ")}}function H(s,o){if(s&1&&(e(0,"div",26)(1,"table")(2,"thead")(3,"tr")(4,"th"),n(5,"Product"),t(),e(6,"th"),n(7,"SKU"),t(),e(8,"th"),n(9,"Stock"),t(),e(10,"th"),n(11,"Min"),t(),e(12,"th"),n(13,"Status"),t(),e(14,"th"),n(15,"Action"),t()()(),e(16,"tbody"),k(17,q,22,8,"tr",null,J),t()()()),s&2){let r=f();a(17),w(r.lowStockProducts())}}var Y=class s{constructor(o,r,i,c){this.productService=o;this.apiService=r;this.authService=i;this.router=c}lowStockProducts=p([]);lowStockCount=M(()=>this.lowStockProducts().length);outOfStockCount=M(()=>this.lowStockProducts().filter(o=>o.stockLevel===0).length);alertSettings=p({enabled:!0,emailAlerts:!1,smsAlerts:!1});defaultThreshold=p(20);error=p("");success=p("");isLoading=p(!1);ngOnInit(){this.loadAlerts(),this.loadSettings()}loadAlerts(){this.isLoading.set(!0),this.apiService.getLowStockAlerts().subscribe({next:o=>{this.lowStockProducts.set(o),this.isLoading.set(!1)},error:o=>{console.error("Error loading low stock alerts from API:",o),this.lowStockProducts.set(this.productService.getLowStockProducts()),this.isLoading.set(!1)}})}loadSettings(){this.apiService.getAlertSettings().subscribe({next:o=>{this.alertSettings.set(o)},error:o=>{console.error("Error loading alert settings from API:",o);let r=localStorage.getItem("alertSettings");if(r)try{this.alertSettings.set(JSON.parse(r))}catch(i){console.error("Error parsing alert settings from localStorage:",i)}}})}saveSettings(){this.error.set(""),this.apiService.updateAlertSettings(this.alertSettings()).subscribe({next:o=>{this.alertSettings.set(o),localStorage.setItem("alertSettings",JSON.stringify(o)),this.success.set("Alert settings saved successfully"),setTimeout(()=>{this.success.set("")},2e3)},error:o=>{console.error("Error saving alert settings:",o),localStorage.setItem("alertSettings",JSON.stringify(this.alertSettings())),this.error.set(o.error?.message||"Failed to save settings to server. Saved locally."),setTimeout(()=>{this.error.set("")},3e3)}})}updateThreshold(o,r){if(r<0){this.error.set("Threshold must be non-negative");return}this.productService.updateProduct(o.id,{minStockThreshold:r}).then(()=>{this.success.set("Threshold updated successfully"),this.loadAlerts(),setTimeout(()=>{this.success.set("")},2e3)}).catch(i=>{this.error.set(i.error?.message||"Failed to update threshold")})}navigateToWelcome(){this.router.navigate(["/welcome"])}navigateToProduct(o){this.router.navigate(["/products"])}static \u0275fac=function(r){return new(r||s)(m(V),m(B),m(D),m(I))};static \u0275cmp=O({type:s,selectors:[["app-alerts"]],decls:89,vars:15,consts:[[1,"layout"],[3,"userName","isAdmin"],[1,"alerts-container"],[1,"header"],[1,"header-content"],[1,"header-actions"],[1,"user-info"],[1,"btn-secondary",3,"click"],[1,"btn-logout",3,"click"],[1,"main-content"],[1,"alert","alert-error"],[1,"alert","alert-success"],[1,"stats-row"],[1,"stat-card"],[1,"stat-icon"],[1,"stat-card","warning"],[1,"stat-card","danger"],[1,"alerts-layout"],[1,"alerts-table-card"],[1,"section-header"],[1,"table-actions"],[1,"search-box"],["type","text","placeholder","Search..."],[1,"search-icon"],[1,"filter-pill"],[1,"no-alerts"],[1,"table-wrapper"],[1,"settings-card"],[1,"settings-content"],[1,"setting-item"],["type","checkbox",3,"ngModelChange","change","ngModel"],["type","checkbox",3,"ngModelChange","change","ngModel","disabled"],[1,"threshold-row"],["type","number",3,"ngModelChange","ngModel"],[1,"btn-save-settings",3,"click"],[1,"no-alerts-icon"],[1,"product-cell"],[1,"product-dot"],[1,"stock-pill"],[1,"status-pill"],[1,"btn-action",3,"click"]],template:function(r,i){if(r&1&&(e(0,"div",0),_(1,"app-sidebar",1),e(2,"div",2)(3,"header",3)(4,"div",4)(5,"h1"),n(6,"Low-Stock Alerts"),t(),e(7,"div",5)(8,"span",6),n(9),t(),e(10,"button",7),g("click",function(){return i.navigateToWelcome()}),n(11,"Back to Dashboard"),t(),e(12,"button",8),g("click",function(){return i.authService.logout()}),n(13,"Logout"),t()()()(),e(14,"main",9),x(15,U,2,1,"div",10),x(16,G,2,1,"div",11),e(17,"div",12)(18,"div",13)(19,"div",14),n(20,"\u{1F4E6}"),t(),e(21,"div")(22,"p"),n(23,"Total Low-Stock Items"),t(),e(24,"h3"),n(25),t()()(),e(26,"div",15)(27,"div",14),n(28,"\u26A0\uFE0F"),t(),e(29,"div")(30,"p"),n(31,"Low Stock Alerts"),t(),e(32,"h3"),n(33),t()()(),e(34,"div",16)(35,"div",14),n(36,"\u26D4"),t(),e(37,"div")(38,"p"),n(39,"Out of Stock"),t(),e(40,"h3"),n(41),t()()()(),e(42,"div",17)(43,"section",18)(44,"div",19)(45,"h2"),n(46,"Low-Stock Products"),t(),e(47,"div",20)(48,"div",21),_(49,"input",22),e(50,"span",23),n(51,"\u{1F50D}"),t()(),e(52,"button",24),n(53,"All Categories \u25BE"),t(),e(54,"button",24),n(55,"All Branches \u25BE"),t()()(),x(56,K,7,0,"div",25)(57,H,19,0,"div",26),t(),e(58,"aside",27)(59,"h2"),n(60,"Alert Settings"),t(),e(61,"div",28)(62,"label",29)(63,"input",30),S("ngModelChange",function(l){return C(i.alertSettings().enabled,l)||(i.alertSettings().enabled=l),l}),g("change",function(){return i.saveSettings()}),t(),e(64,"div")(65,"span"),n(66,"Enable Alerts"),t(),e(67,"p"),n(68,"Receive notifications when stock falls below the minimum threshold."),t()()(),e(69,"label",29)(70,"input",31),S("ngModelChange",function(l){return C(i.alertSettings().emailAlerts,l)||(i.alertSettings().emailAlerts=l),l}),g("change",function(){return i.saveSettings()}),t(),e(71,"div")(72,"span"),n(73,"Email Alerts"),t(),e(74,"p"),n(75,"Receive alerts via email."),t()()(),e(76,"label",29)(77,"input",31),S("ngModelChange",function(l){return C(i.alertSettings().smsAlerts,l)||(i.alertSettings().smsAlerts=l),l}),g("change",function(){return i.saveSettings()}),t(),e(78,"div")(79,"span"),n(80,"SMS Alerts"),t(),e(81,"p"),n(82,"Receive alerts via SMS."),t()()(),e(83,"div",32)(84,"span"),n(85,"Default Threshold"),t(),e(86,"input",33),g("ngModelChange",function(l){return i.defaultThreshold.set(l)}),t()(),e(87,"button",34),g("click",function(){return i.saveSettings()}),n(88,"Save Settings"),t()()()()()()()),r&2){let c,l;a(),u("userName",((c=i.authService.currentUser())==null?null:c.name)||"")("isAdmin",i.authService.isAdmin()),a(8),d((l=i.authService.currentUser())==null?null:l.name),a(6),h(i.error()?15:-1),a(),h(i.success()?16:-1),a(9),d(i.lowStockCount()),a(8),d(i.lowStockCount()),a(8),d(i.outOfStockCount()),a(15),h(i.lowStockProducts().length===0?56:57),a(7),b("ngModel",i.alertSettings().enabled),a(7),b("ngModel",i.alertSettings().emailAlerts),u("disabled",!i.alertSettings().enabled),a(7),b("ngModel",i.alertSettings().smsAlerts),u("disabled",!i.alertSettings().enabled),a(9),u("ngModel",i.defaultThreshold())}},dependencies:[T,j,L,F,z,N,W,R],styles:[".layout[_ngcontent-%COMP%]{display:flex;min-height:100vh;background:#f6f7fb}.alerts-container[_ngcontent-%COMP%]{flex:1;margin-left:var(--sidebar-width, 270px);min-height:100vh;background:#f6f7fb;display:flex;flex-direction:column}@media (max-width: 768px){.alerts-container[_ngcontent-%COMP%]{margin-left:0}}.header[_ngcontent-%COMP%]{background:#fffffff2;padding:20px 0;box-shadow:0 2px 10px #00000014;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]{max-width:1400px;margin:0 auto;padding:0 24px;display:flex;justify-content:space-between;align-items:center}.header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;color:#2d3748;font-size:28px;font-weight:700;background:linear-gradient(135deg,#4b5eea,#5a6efb);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{color:#718096;font-size:14px;padding-right:12px;border-right:1px solid #e2e8f0;font-weight:500}.header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .btn-secondary[_ngcontent-%COMP%]{padding:10px 20px;background:#edf2f7;color:#4a5568;border:none;border-radius:8px;cursor:pointer;font-size:14px;font-weight:600;transition:all .2s}.header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .btn-secondary[_ngcontent-%COMP%]:hover{background:#e2e8f0;transform:translateY(-1px)}.header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .btn-logout[_ngcontent-%COMP%]{padding:10px 20px;background:#fc8181;color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:14px;font-weight:600;transition:all .2s}.header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .btn-logout[_ngcontent-%COMP%]:hover{background:#f56565;transform:translateY(-1px)}.main-content[_ngcontent-%COMP%]{max-width:1400px;margin:0 auto;padding:32px 24px}.alert[_ngcontent-%COMP%]{padding:16px 20px;border-radius:12px;margin-bottom:24px;font-weight:500;display:flex;align-items:center;gap:12px;animation:_ngcontent-%COMP%_slideDown .3s ease-out}.alert.alert-error[_ngcontent-%COMP%]{background:#fed7d7;color:#c53030;border-left:4px solid #fc8181}.alert.alert-success[_ngcontent-%COMP%]{background:#c6f6d5;color:#22543d;border-left:4px solid #48bb78}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.stats-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:18px;margin-bottom:28px}.stat-card[_ngcontent-%COMP%]{background:#fff;border-radius:14px;padding:18px;display:flex;align-items:center;gap:14px;box-shadow:0 4px 14px #00000014}.stat-card[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:14px;display:grid;place-items:center;background:#e9efff;font-size:20px}.stat-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:6px 0 0;font-size:24px;color:#2d3748}.stat-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#718096;font-size:13px;font-weight:600}.stat-card.warning[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]{background:#fff4e5}.stat-card.danger[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]{background:#ffe5e5}.alerts-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:minmax(0,1fr) 360px;gap:24px}@media (max-width: 1024px){.alerts-layout[_ngcontent-%COMP%]{grid-template-columns:1fr}}.alerts-table-card[_ngcontent-%COMP%]{background:#fff;border-radius:18px;padding:24px;box-shadow:0 4px 18px #00000014}.alerts-table-card[_ngcontent-%COMP%]   .section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:16px;margin-bottom:20px}.alerts-table-card[_ngcontent-%COMP%]   .section-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#2d3748;font-size:22px;font-weight:700}.alerts-table-card[_ngcontent-%COMP%]   .section-header[_ngcontent-%COMP%]   .table-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;flex-wrap:wrap}.alerts-table-card[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]{position:relative}.alerts-table-card[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:10px 36px 10px 14px;border:1px solid #e2e8f0;border-radius:10px;background:#f8f9ff;font-size:13px}.alerts-table-card[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{position:absolute;right:12px;top:50%;transform:translateY(-50%);color:#a0aec0;font-size:14px}.alerts-table-card[_ngcontent-%COMP%]   .filter-pill[_ngcontent-%COMP%]{border:1px solid #e2e8f0;background:#f8f9ff;padding:9px 14px;border-radius:10px;font-size:13px;color:#4a5568;cursor:pointer}.table-wrapper[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;min-width:600px}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;padding:12px 10px;font-size:12px;text-transform:uppercase;color:#718096;border-bottom:1px solid #edf2f7}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:14px 10px;font-size:13px;color:#2d3748;border-bottom:1px solid #f1f5f9}.product-cell[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.product-cell[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;font-weight:600}.product-cell[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;font-size:12px;color:#a0aec0}.product-dot[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%;background:#5a6efb}.stock-pill[_ngcontent-%COMP%]{background:#edf2ff;padding:4px 10px;border-radius:999px;font-weight:600}.status-pill[_ngcontent-%COMP%]{padding:4px 12px;border-radius:999px;background:#fff4e5;color:#c05621;font-weight:600;font-size:12px}.status-pill.critical[_ngcontent-%COMP%]{background:#ffe5e5;color:#c53030}.btn-action[_ngcontent-%COMP%]{padding:6px 14px;border-radius:10px;border:none;background:#ff8b3d;color:#fff;font-size:12px;font-weight:600;cursor:pointer}.settings-card[_ngcontent-%COMP%]{background:#fff;border-radius:18px;padding:24px;box-shadow:0 4px 18px #00000014;height:fit-content}.settings-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 20px;font-size:20px;color:#2d3748}.settings-card[_ngcontent-%COMP%]   .settings-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.settings-card[_ngcontent-%COMP%]   .setting-item[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:flex-start;padding-bottom:12px;border-bottom:1px solid #edf2f7;cursor:pointer}.settings-card[_ngcontent-%COMP%]   .setting-item[_ngcontent-%COMP%]:last-child{border-bottom:none;padding-bottom:0}.settings-card[_ngcontent-%COMP%]   .setting-item[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:18px;height:18px;accent-color:#5a6efb;margin-top:3px}.settings-card[_ngcontent-%COMP%]   .setting-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600;font-size:14px;color:#2d3748}.settings-card[_ngcontent-%COMP%]   .setting-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:6px 0 0;font-size:12px;color:#718096;line-height:1.4}.settings-card[_ngcontent-%COMP%]   .threshold-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-size:13px;color:#4a5568;gap:12px}.settings-card[_ngcontent-%COMP%]   .threshold-row[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:80px;padding:6px 10px;border-radius:8px;border:1px solid #e2e8f0;background:#f8f9ff}.settings-card[_ngcontent-%COMP%]   .btn-save-settings[_ngcontent-%COMP%]{margin-top:8px;width:100%;padding:10px 16px;border:none;border-radius:10px;background:#ff8b3d;color:#fff;font-weight:600;cursor:pointer}"]})};export{Y as AlertsComponent};
